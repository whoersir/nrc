# åç«¯ API æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¥æœŸ**ï¼š2026-01-31
**æµ‹è¯•ç¯å¢ƒ**ï¼šæœ¬åœ°å¼€å‘æœåŠ¡å™¨ (localhost:5000)

---

## âœ… æµ‹è¯•é€šè¿‡

### 1. éŸ³ä¹åº“æ‰«æ API

**ç«¯ç‚¹**ï¼š`POST /api/music/scan`

**è¯·æ±‚**ï¼š
```json
{
  "verbose": true,
  "extractMetadata": false
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "æ‰«æå®Œæˆï¼Œå…± 915 é¦–æ­Œæ›²",
  "data": {
    "totalTracks": 915,
    "totalArtists": 238,
    "totalSize": 30373607616,
    "syncedCount": 915,
    "scannedFiles": 915,
    "errors": []
  }
}
```

**ç»“æœ**ï¼šâœ… é€šè¿‡
- æ‰«æåˆ° 915 é¦–æ­Œæ›²
- 238 ä½æ­Œæ‰‹
- çº¦ 30GB éŸ³ä¹æ•°æ®
- å…¨éƒ¨åŒæ­¥åˆ°æ•°æ®åº“æˆåŠŸ

---

### 2. æ­Œæ›²åˆ—è¡¨ API

**ç«¯ç‚¹**ï¼š`GET /api/music/tracks?page=1&limit=5`

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": [
    {
      "id": "track_6412cc2d",
      "filename": "123æœ¨å¤´äºº.wav",
      "title": "01. 123æœ¨å¤´äºº.wav",
      "title_pinyin": "01.123mutouren.wav",
      "title_first_letter": "#",
      "artist": "é»‘Girl",
      "artist_pinyin": "heigirl",
      "artist_first_letter": "H",
      "album": null,
      "duration": null,
      "file_size": 41769368,
      "format": "wav",
      "added_at": "2026-01-31T05:07:29.117"
    }
  ],
  "total": 915,
  "page": 1,
  "limit": 5
}
```

**ç»“æœ**ï¼šâœ… é€šè¿‡
- æˆåŠŸè¿”å›æ­Œæ›²åˆ—è¡¨
- æ‹¼éŸ³è½¬æ¢æ­£ç¡®
- åˆ†é¡µåŠŸèƒ½æ­£å¸¸
- æ€»æ•°ç»Ÿè®¡æ­£ç¡®ï¼ˆ915 é¦–ï¼‰

---

### 3. æ­Œæ‰‹åˆ—è¡¨ API

**ç«¯ç‚¹**ï¼š`GET /api/music/artists?limit=5`

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": [
    {
      "name": "é˜¿æœ",
      "pinyin": "adu",
      "firstLetter": "A",
      "trackCount": 4
    },
    {
      "name": "é˜¿é‡Œéƒ",
      "pinyin": "alilang",
      "firstLetter": "A",
      "trackCount": 2
    }
  ],
  "total": 237
}
```

**ç»“æœ**ï¼šâœ… é€šè¿‡
- æˆåŠŸè¿”å›æ­Œæ‰‹åˆ—è¡¨
- æŒ‰æ‹¼éŸ³æ’åºæ­£ç¡®
- æ­Œæ›²æ•°é‡ç»Ÿè®¡å‡†ç¡®
- æœ€çƒ­æ­Œæ‰‹ï¼šå‘¨æ°ä¼¦ï¼ˆ221 é¦–ï¼‰

---

## ğŸ“Š æ•°æ®ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æ€»æ­Œæ›²æ•° | 915 é¦– |
| æ€»æ­Œæ‰‹æ•° | 238 ä½ |
| æ€»å¤§å° | çº¦ 30GB |
| æœ€çƒ­æ­Œæ‰‹ | å‘¨æ°ä¼¦ï¼ˆ221 é¦–ï¼‰ |

### Top 5 æ­Œæ‰‹

| æ’å | æ­Œæ‰‹ | æ­Œæ›²æ•°é‡ |
|------|------|---------|
| 1 | å‘¨æ°ä¼¦ | 221 é¦– |
| 2 | å¼ å­¦å‹ | 19 é¦– |
| 3 | é™ˆç‘ | 12 é¦– |
| 4 | å‘¨åå¥ | 6 é¦– |
| 5 | å¼ ä¿¡å“² | 3 é¦– |

---

## ğŸ”§ é—®é¢˜ä¿®å¤

### é—®é¢˜ 1ï¼šå®¢æˆ·ç«¯ Supabase å®ä¾‹åœ¨æœåŠ¡ç«¯ä¸å¯ç”¨

**é”™è¯¯**ï¼š
```
Attempted to call getSupabase() from server but getSupabase is on client.
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åˆ›å»ºæœåŠ¡ç«¯ Supabase å®¢æˆ·ç«¯ (`src/lib/supabase-server.ts`)
- æ›´æ–° `MusicService` ä½¿ç”¨æœåŠ¡ç«¯å®¢æˆ·ç«¯
- æ‰€æœ‰ API è·¯ç”±ç°åœ¨ä½¿ç”¨æœåŠ¡ç«¯ Supabase å®ä¾‹

**çŠ¶æ€**ï¼šâœ… å·²ä¿®å¤

---

### é—®é¢˜ 2ï¼šæ•°æ®åº“è¡¨å¤–é”®çº¦æŸé—®é¢˜

**åŸå› **ï¼š
Supabase çš„ `auth.users` è¡¨æ— æ³•åœ¨ public schema ä¸­ç›´æ¥å¼•ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç§»é™¤å¤–é”®çº¦æŸ
- æ”¹ä¸ºåº”ç”¨å±‚æ§åˆ¶æ•°æ®ä¸€è‡´æ€§
- ä½¿ç”¨ UNIQUE çº¦æŸä¿è¯æ•°æ®å®Œæ•´æ€§

**çŠ¶æ€**ï¼šâœ… å·²ä¿®å¤

---

## ğŸ“ æµ‹è¯•å‘½ä»¤

### æ‰«æéŸ³ä¹åº“
```bash
curl -X POST http://localhost:5000/api/music/scan \
  -H "Content-Type: application/json" \
  -d '{"verbose": true, "extractMetadata": false}'
```

### è·å–æ­Œæ›²åˆ—è¡¨
```bash
curl "http://localhost:5000/api/music/tracks?page=1&limit=10"
```

### è·å–æ­Œæ‰‹åˆ—è¡¨
```bash
curl "http://localhost:5000/api/music/artists"
```

### æŒ‰é¦–å­—æ¯ç­›é€‰
```bash
curl "http://localhost:5000/api/music/tracks?letter=A"
```

### æŒ‰æ­Œæ‰‹ç­›é€‰
```bash
curl "http://localhost:5000/api/music/tracks?artist=å‘¨æ°ä¼¦"
```

---

## âœ… æ€»ç»“

æ‰€æœ‰æ ¸å¿ƒ API æµ‹è¯•é€šè¿‡ï¼åç«¯åŸºç¡€å·²å®Œå…¨å°±ç»ªï¼Œå¯ä»¥å¼€å§‹ Phase 3 å‰ç«¯å¼€å‘ã€‚

### ä¸‹ä¸€æ­¥ï¼šPhase 3 - å‰ç«¯ UI é‡æ„

è®¡åˆ’å®Œæˆçš„åŠŸèƒ½ï¼š
- âœ… æ’­æ”¾æ¨¡å¼åˆ‡æ¢ï¼ˆé¡ºåº/éšæœº/å•æ›²å¾ªç¯ï¼‰
- âœ… ä¸‰ç§è§†å›¾åˆ‡æ¢ï¼ˆå…¨éƒ¨éŸ³ä¹/æ­Œæ‰‹åˆ—è¡¨/æ”¶è—éŸ³ä¹ï¼‰
- âœ… A-Z å¿«é€Ÿè·³è½¬å¯¼èˆª
- âœ… åˆ·æ–°æŒ‰é’®
- âœ… æ­Œæ‰‹å¡ç‰‡å¸ƒå±€ï¼ˆç‚¹å‡»å¼¹å‡ºå¯¹è¯æ¡†ï¼‰
- âœ… ç”¨æˆ·æ”¶è—åŠŸèƒ½
